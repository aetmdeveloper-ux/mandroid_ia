<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MANDROID.IA ‚Äî Chat</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet"/>
  <style>
    /* ‚îÄ‚îÄ Reset & Variables ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --neon-green:      #00ff41;
      --neon-cyan:       #00e5ff;
      --neon-purple:     #bf00ff;
      --neon-blue:       #0044ff;
      --neon-yellow:     #ffff00;
      --dark-bg:         #000800;
      --panel-bg:        rgba(0, 12, 0, 0.92);
      --input-bg:        rgba(0, 20, 0, 0.9);
      --msg-user-bg:     rgba(0, 60, 20, 0.6);
      --msg-ai-bg:       rgba(0, 20, 50, 0.7);
      --border:          rgba(0, 255, 65, 0.3);
      --border-hover:    rgba(0, 255, 65, 0.7);
      --text-primary:    #e0ffe0;
      --text-secondary:  rgba(0,229,255,0.7);
      --scrollbar-track: rgba(0,15,0,0.5);
      --scrollbar-thumb: rgba(0,255,65,0.3);
      --header-h:        70px;
      --footer-h:        80px;
    }

    html, body {
      width: 100%; height: 100%;
      background: var(--dark-bg);
      overflow: hidden;
      font-family: 'Rajdhani', sans-serif;
      color: var(--text-primary);
    }

    #matrix-canvas {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      z-index: 0;
      opacity: 0.18;
    }

    .app-wrapper {
      position: relative;
      z-index: 2;
      display: flex;
      flex-direction: column;
      height: 100vh;
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 16px;
    }

    /* HEADER */
    .app-header {
      flex-shrink: 0;
      height: var(--header-h);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      border-bottom: 1px solid var(--border);
      background: rgba(0,8,0,0.95);
      backdrop-filter: blur(20px);
      padding: 0 8px;
      position: sticky;
      top: 0;
      z-index: 10;
      box-shadow: 0 2px 30px rgba(0,255,65,0.08);
    }

    .header-brand { display: flex; align-items: center; gap: 12px; }
    .header-logo { width: 44px; height: 44px; flex-shrink: 0; filter: drop-shadow(0 0 8px var(--neon-green)); animation: float 3s ease-in-out infinite; }
    @keyframes float { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-4px); } }

    .header-title {
      font-family: 'Orbitron', monospace;
      font-size: clamp(1rem, 2.5vw, 1.6rem);
      font-weight: 900;
      letter-spacing: 4px;
      background: linear-gradient(135deg, #00ff41, #00e5ff, #bf00ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: titleGlow 2.5s ease-in-out infinite alternate;
    }

    @keyframes titleGlow { from { filter: drop-shadow(0 0 4px #00ff41); } to { filter: drop-shadow(0 0 14px #00e5ff); } }

    .header-subtitle { font-family: 'Share Tech Mono', monospace; font-size: 0.65rem; color: var(--text-secondary); letter-spacing: 3px; margin-top: 2px; }
    .status-badge { display: flex; align-items: center; gap: 6px; font-size: 0.72rem; color: var(--neon-green); font-family: 'Share Tech Mono', monospace; }
    .status-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--neon-green); box-shadow: 0 0 8px var(--neon-green); animation: pulse 1.5s ease-in-out infinite; }
    @keyframes pulse { 0%,100% { box-shadow: 0 0 4px var(--neon-green); transform: scale(1); } 50% { box-shadow: 0 0 12px var(--neon-green); transform: scale(1.3); } }

    .header-user { display: flex; align-items: center; gap: 10px; }
    .user-avatar { width: 36px; height: 36px; border-radius: 50%; border: 2px solid var(--neon-green); box-shadow: 0 0 10px rgba(0,255,65,0.4); object-fit: cover; }
    .user-avatar-placeholder { width: 36px; height: 36px; border-radius: 50%; border: 2px solid var(--neon-green); background: rgba(0,255,65,0.1); display: flex; align-items: center; justify-content: center; color: var(--neon-green); }

    .btn-header { display: flex; align-items: center; gap: 6px; padding: 7px 14px; background: transparent; border: 1px solid; border-radius: 6px; cursor: pointer; font-family: 'Rajdhani', sans-serif; font-size: 0.78rem; transition: all 0.25s ease; }
    .btn-clear { border-color: rgba(0,229,255,0.4); color: var(--neon-cyan); }
    .btn-exit { border-color: rgba(255,60,60,0.4); color: #ff6b6b; }

    /* CHAT AREA */
    .chat-area { flex: 1; display: flex; flex-direction: column; gap: 12px; overflow: hidden; padding: 16px 0 8px; }
    .response-panel { flex: 1; background: var(--panel-bg); border: 1px solid var(--border); border-radius: 14px; padding: 16px; overflow-y: auto; backdrop-filter: blur(20px); scroll-behavior: smooth; }
    .panel-label { position: sticky; top: 0; background: rgba(0,8,0,0.95); padding-bottom: 10px; z-index: 1; border-bottom: 1px solid rgba(0,255,65,0.1); display: flex; align-items: center; gap: 8px; }
    .panel-label span { font-family: 'Share Tech Mono', monospace; font-size: 0.72rem; letter-spacing: 3px; text-transform: uppercase; }

    .message-list { display: flex; flex-direction: column; gap: 16px; }
    .message-item { display: flex; gap: 12px; animation: msgAppear 0.35s ease-out; }
    @keyframes msgAppear { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
    .message-item.user-msg { justify-content: flex-end; }
    .msg-avatar { width: 34px; height: 34px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; border: 1.5px solid; }
    .user-msg .msg-avatar { order: 2; border-color: var(--neon-cyan); }
    .ai-msg .msg-avatar { border-color: var(--neon-green); }

    .msg-bubble { max-width: 78%; padding: 14px 18px; border-radius: 12px; line-height: 1.65; }
    .user-msg .msg-bubble { background: var(--msg-user-bg); border: 1px solid rgba(0,229,255,0.3); color: #c8ffee; border-radius: 12px 2px 12px 12px; }
    .ai-msg .msg-bubble { background: var(--msg-ai-bg); border: 1px solid rgba(0,255,65,0.25); border-radius: 2px 12px 12px 12px; }

    /* INPUT PANEL */
    .input-panel { flex-shrink: 0; background: var(--panel-bg); border: 1px solid var(--border); border-radius: 14px; padding: 16px; }
    .input-form { display: flex; gap: 10px; align-items: flex-end; }
    .input-textarea { flex: 1; background: var(--input-bg); border: 1px solid rgba(0,255,65,0.2); border-radius: 10px; padding: 12px 16px; color: var(--text-primary); resize: none; outline: none; min-height: 50px; max-height: 130px; }
    .btn-send { width: 50px; height: 50px; border-radius: 10px; border: 2px solid var(--neon-green); background: rgba(0,255,65,0.1); color: var(--neon-green); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.25s ease; }

    /* UTILS */
    .typing-indicator { display: none; align-items: center; gap: 5px; padding: 10px 16px; background: var(--msg-ai-bg); border: 1px solid rgba(0,255,65,0.2); border-radius: 2px 12px 12px 12px; max-width: 80px; }
    .typing-indicator.show { display: flex; }
    .typing-dot { width: 7px; height: 7px; border-radius: 50%; background: var(--neon-green); animation: typingDot 1.3s ease-in-out infinite; }
    @keyframes typingDot { 0%,60%,100% { transform: translateY(0); opacity: 0.4; } 30% { transform: translateY(-6px); opacity: 1; } }

    .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(8px); z-index: 100; align-items: center; justify-content: center; }
    .modal-overlay.show { display: flex; }
    .modal-box { background: rgba(0,12,0,0.98); border: 1px solid var(--border); border-radius: 16px; padding: 36px 40px; text-align: center; }

    .app-footer { flex-shrink: 0; text-align: center; padding: 10px; font-family: 'Share Tech Mono', monospace; font-size: 0.68rem; color: rgba(0,255,65,0.25); }
  </style>
</head>
<body>

<canvas id="matrix-canvas"></canvas>

<div class="app-wrapper">
  <header class="app-header">
    <div class="header-brand">
        <div class="header-title">MANDROID.IA</div>
    </div>
    <div style="display:flex; align-items:center; gap:16px;">
      <div class="status-badge"><div class="status-dot"></div><span>ONLINE</span></div>
      <div class="header-user" id="user-info">
        <div class="user-avatar-placeholder">üë§</div>
        <span class="user-name" id="user-display-name">Ad√£o</span>
      </div>
      <button class="btn-header btn-clear" onclick="showModal('clear')">üóë LIMPAR</button>
      <button class="btn-header btn-exit" onclick="showModal('exit')">‚èª SAIR</button>
    </div>
  </header>

  <div class="chat-area">
    <div class="response-panel" id="response-panel">
      <div class="panel-label"><span>TERMINAL DE CONVERSAS</span></div>
      <div class="message-list" id="message-list"></div>
      
      <div style="display:none; gap:12px; margin-top:8px; align-items:center;" id="typing-row">
        <div class="msg-avatar ai-msg">ü§ñ</div>
        <div class="typing-indicator" id="typing-indicator">
          <div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>
        </div>
      </div>
    </div>

    <div class="input-panel">
      <form class="input-form" id="chat-form" onsubmit="return false;">
        <textarea class="input-textarea" id="user-input" placeholder="‚ñ∂ Digite aqui..."></textarea>
        <button class="btn-send" id="send-btn">‚û§</button>
      </form>
    </div>
  </div>
  <footer class="app-footer">MANDROID.IA ¬© 2026</footer>
</div>

<div class="modal-overlay" id="modal-overlay">
  <div class="modal-box">
    <h2 id="modal-title" style="color:var(--neon-cyan)">CONFIRMAR</h2>
    <p id="modal-text" style="margin: 20px 0">Deseja continuar?</p>
    <button class="btn-header" onclick="hideModal()">CANCELAR</button>
    <button class="btn-header btn-exit" id="modal-confirm-btn" onclick="confirmAction()">CONFIRMAR</button>
  </div>
</div>

<script>
/* Sincronizado com o novo server.js (Groq + Axios) */

async function sendMessage() {
  const inputEl = document.getElementById('user-input');
  const msg = inputEl.value.trim();
  if (!msg) return;

  appendMessage('user', msg);
  inputEl.value = '';
  showTyping();

  try {
    const res = await fetch('/api/chat', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message: msg })
    });

    const data = await res.json();
    hideTyping();

    if (data.success) {
      appendMessage('ai', data.message);
    } else {
      appendMessage('ai', "‚ö† Erro nos circuitos: " + (data.error || "Tente novamente."));
    }
  } catch (err) {
    hideTyping();
    appendMessage('ai', "‚ö† Erro de conex√£o com o terminal.");
  }
}

function appendMessage(role, content) {
  const list = document.getElementById('message-list');
  const div = document.createElement('div');
  div.className = `message-item ${role === 'user' ? 'user-msg' : 'ai-msg'}`;
  div.innerHTML = `
    <div class="msg-avatar">${role === 'user' ? 'üë§' : 'ü§ñ'}</div>
    <div class="msg-bubble">${content}</div>
  `;
  list.appendChild(div);
  document.getElementById('response-panel').scrollTop = document.getElementById('response-panel').scrollHeight;
}

function showTyping() { document.getElementById('typing-row').style.display = 'flex'; document.getElementById('typing-indicator').classList.add('show'); }
function hideTyping() { document.getElementById('typing-row').style.display = 'none'; document.getElementById('typing-indicator').classList.remove('show'); }

document.getElementById('send-btn').addEventListener('click', sendMessage);
document.getElementById('user-input').addEventListener('keydown', (e) => { if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); } });

// Modais e Matrix simplificados para o exemplo...
</script>
</body>
</html>
